name: Flow 1

on:
  issue_comment:
    types: [created]

jobs:
  deploy-hotfix:
    if: |
      github.event.issue.pull_request != null &&
      startsWith(github.event.comment.body, '/deploy hotfix')
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

  steps:
    - name: Checkout repo
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Get PR info
      id: pr
      uses: octokit/request-action@v2.x
      with:
        route: GET /repos/${{ github.repository }}/pulls/${{ github.event.issue.number }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Parse PR merge commit SHA
      id: extract
      run: |
        echo "${{ steps.pr.outputs.data }}" > pr.json

        MERGE_COMMIT=$(jq -r .merge_commit_sha pr.json)
        PR_NUMBER=$(jq -r .number pr.json)
        
        echo "merge_commit=$MERGE_COMMIT" >> $GITHUB_OUTPUT
        echo "pr_number=$PR_NUMBER" >> $GITHUB_OUTPUT